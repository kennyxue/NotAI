# 问题追踪日志

本文档记录项目开发过程中遇到的问题及其解决方案。

## 问题分类

### 1. 环境配置问题

### 2. 构建问题

#### 2.1 FileManager 命名冲突
- 日期：2025/2/6
- 类型：构建错误
- 描述：Constants.swift 文件中的 FileManager 枚举与 Foundation.FileManager 产生命名冲突
- 影响：项目无法编译，出现 "Type 'Constants.FileManager' has no member 'default'" 等错误
- 解决方案：将 Constants.FileManager 重命名为 Constants.FileManagerConstants，并明确指定 Foundation.FileManager
- 预防措施：
  1. 避免使用与系统框架相同的命名
  2. 使用更具描述性的命名来避免冲突
  3. 在使用系统类型时，明确指定命名空间

#### 2.2 SwiftUI API 废弃警告
- 日期：2025/2/6
- 类型：编译警告
- 描述：onChange(of:perform:) 在 macOS 14.0 中已废弃
- 影响：产生编译警告，未来可能不受支持
- 解决方案：使用新的 onChange 方法，包含两个或零个参数的闭包
- 预防措施：
  1. 及时关注 API 更新和废弃通知
  2. 定期更新代码以使用最新的 API
  3. 在开发时优先使用最新推荐的 API

#### 2.3 未使用变量警告
- 日期：2025/2/6
- 类型：编译警告
- 描述：变量定义后未使用
- 影响：代码冗余，可能影响可维护性
- 解决方案：移除未使用的变量绑定，直接使用条件判断
- 预防措施：
  1. 代码审查时注意检查未使用的变量
  2. 使用编译器警告来帮助发现未使用的变量
  3. 保持代码简洁，避免不必要的变量声明

#### 2.4 类型不符合 Hashable 协议错误
- 日期：2025/2/6
- 类型：构建错误
- 描述：Directory 类型在用于 List selection 时需要遵循 Hashable 协议
- 影响：项目无法编译，出现 "requires that 'Directory' conform to 'Hashable'" 错误
- 解决方案：
  1. 让 Directory 结构体遵循 Hashable 协议
  2. 实现 hash(into:) 方法
  3. 实现 == 操作符
- 预防措施：
  1. 在使用 SwiftUI 的选择功能时，确保相关类型遵循必要的协议
  2. 使用 Xcode 的协议一致性检查
  3. 查看 API 文档中的类型要求

#### 2.5 类型不符合 Equatable 协议错误
- 日期：2025/2/6
- 类型：构建错误
- 描述：Document 类型在用于 onChange 监听时需要遵循 Equatable 协议
- 影响：项目无法编译，出现 "requires that 'Document' conform to 'Equatable'" 错误
- 解决方案：
  1. 让 Document 结构体遵循 Equatable 协议
  2. 实现 == 操作符，基于 id 进行比较
- 预防措施：
  1. 在使用 SwiftUI 的 onChange 修饰符时，确保相关类型遵循必要的协议
  2. 使用 Xcode 的协议一致性检查
  3. 查看 API 文档中的类型要求
  4. 注意 Optional 类型的协议要求

### 3. 运行时问题

### 4. 性能问题

### 5. UI/UX问题

#### 5.1 界面布局优化
- 日期：2025/2/6
- 类型：UI改进
- 描述：需要优化界面布局，添加侧边栏显示控制
- 影响：用户体验和界面灵活性
- 解决方案：
  1. 添加侧边栏显示控制按钮
  2. 实现侧边栏的动画显示/隐藏
  3. 使用常量管理UI尺寸和样式
  4. 优化工具栏布局
- 预防措施：
  1. 使用统一的UI常量管理系统
  2. 实现响应式布局
  3. 保持界面设计的一致性

#### 5.2 侧边栏功能增强
- 日期：2025/2/6
- 类型：功能增强
- 描述：侧边栏需要支持目录和搜索功能
- 影响：用户体验和功能完整性
- 解决方案：
  1. 添加目录/搜索切换标签
  2. 实现目录的层级显示
  3. 添加搜索功能
  4. 优化目录树的展开/折叠
- 预防措施：
  1. 使用合适的数据结构管理目录层级
  2. 实现高效的搜索算法
  3. 注意大量数据时的性能优化

#### 5.3 目录布局调整
- 日期：2025/2/6
- 类型：UI改进
- 描述：需要将父子目录改为左右并列显示，并实现目录选择联动
- 影响：用户交互体验
- 解决方案：
  1. 修改VSplitView为HStack实现左右布局
  2. 使用List的selection属性实现目录选择
  3. 添加目录选择的状态监听
  4. 优化目录项的视觉样式
- 预防措施：
  1. 使用SwiftUI的声明式布局
  2. 实现适当的状态管理
  3. 注意布局的响应式调整

#### 5.4 侧边栏宽度调整
- 日期：2025/2/6
- 类型：UI改进
- 描述：右侧边栏隐藏时左侧边栏宽度不正确
- 影响：界面布局不合理
- 解决方案：
  1. 使用固定宽度替代最小/最大宽度
  2. 调整布局约束
  3. 优化窗口尺寸设置
- 预防措施：
  1. 使用常量管理尺寸
  2. 测试不同窗口状态
  3. 注意布局约束的影响

#### 5.5 文档编辑功能增强
- 日期：2025/2/6
- 类型：功能增强
- 描述：需要实现文档编辑和状态管理
- 影响：用户编辑体验
- 解决方案：
  1. 添加文档标题显示
  2. 实现文档内容编辑
  3. 优化状态管理
  4. 添加更多测试数据
- 预防措施：
  1. 使用适当的状态管理模式
  2. 实现数据的双向绑定
  3. 注意性能优化

#### 5.6 目录选择功能问题
- 日期：2025/2/6
- 类型：功能缺陷
- 描述：点击父级目录时没有显示对应的子级目录
- 影响：用户无法正常浏览和选择文档
- 解决方案：
  1. 修改目录列表实现方式，从 List 改为 ScrollView + LazyVStack
  2. 使用 onTapGesture 替代 selection 绑定
  3. 添加选中状态的视觉反馈
  4. 优化目录项的布局和样式
- 预防措施：
  1. 在实现状态管理时进行充分测试
  2. 确保状态更新能触发视图刷新
  3. 添加适当的视觉反馈
  4. 注意用户交互的连贯性

#### 5.7 文档切换功能问题
- 日期：2025/2/6
- 类型：功能缺陷
- 描述：切换子级目录时主编辑区域内容未更新
- 影响：用户无法正确查看不同文档的内容
- 解决方案：
  1. 添加文档切换的状态监听
  2. 实现文档内容的双向绑定
  3. 优化文档状态管理
  4. 完善文档更新逻辑
- 预防措施：
  1. 确保状态变化能正确触发视图更新
  2. 实现完整的状态管理生命周期
  3. 添加必要的状态监听
  4. 测试各种状态切换场景

#### 5.8 响应式布局问题
- 日期：2025/2/6
- 类型：UI缺陷
- 描述：窗口宽度调整时出现显示问题，部分侧边栏内容无法显示，且窗口最小宽度限制不合理
- 影响：用户界面在不同窗口尺寸下的可用性
- 解决方案：
  1. 重新计算并设置合理的窗口最小宽度（1000）
  2. 为分隔线和边距添加专门的常量
  3. 给予编辑区域更高的布局优先级
  4. 在计算侧边栏宽度时考虑分隔线宽度
  5. 确保所有区域都有合理的最小宽度限制
- 预防措施：
  1. 在开发时就考虑不同屏幕尺寸的适配
  2. 使用合理的布局约束和尺寸限制
  3. 测试不同窗口尺寸下的显示效果
  4. 建立清晰的响应式设计规范
  5. 仔细计算所有UI元素所需的最小空间

#### 5.9 自动保存功能实现
- 日期：2025/2/6
- 类型：功能增强
- 描述：需要实现文档的自动保存功能
- 影响：用户数据安全性和用户体验
- 解决方案：
  1. 在DocumentViewModel中添加Timer实现定时保存
  2. 使用lastSaveDate跟踪上次保存时间
  3. 实现保存时的错误处理
  4. 添加保存状态提示
- 预防措施：
  1. 使用weak self避免内存泄漏
  2. 在适当的时机取消Timer
  3. 实现错误恢复机制
  4. 保存前验证数据完整性

#### 5.10 数据持久化实现
- 日期：2025/2/6
- 类型：功能增强
- 描述：需要实现可靠的数据持久化功能
- 影响：数据安全性和应用稳定性
- 解决方案：
  1. 实现DataStore单例类
  2. 使用FileManager进行文件操作
  3. 实现数据编码和解码
  4. 添加错误处理机制
- 预防措施：
  1. 使用适当的文件命名和组织
  2. 实现数据备份机制
  3. 处理并发访问
  4. 验证数据完整性

#### 5.11 目录管理优化
- 日期：2025/2/6
- 类型：功能优化
- 描述：需要优化目录管理功能
- 影响：用户体验和数据组织
- 解决方案：
  1. 实现目录树的递归操作
  2. 优化目录数据结构
  3. 实现目录的CRUD操作
  4. 添加目录状态管理
- 预防措施：
  1. 注意深层目录的性能
  2. 实现目录缓存机制
  3. 处理循环引用
  4. 保持数据一致性

#### 5.12 NSSecureCoding解码问题
- 日期：2025/2/6
- 类型：安全性问题
- 描述：NSSecureCoding允许类列表包含NSObject类，可能导致安全隐患
- 影响：数据解码安全性和应用稳定性
- 解决方案：
  1. 明确指定允许解码的具体类型
  2. 避免使用NSObject作为基类
  3. 实现自定义的安全解码机制
  4. 添加类型验证
- 预防措施：
  1. 在模型类中实现严格的类型检查
  2. 使用具体的类型而不是通用类型
  3. 定期进行安全审查
  4. 添加日志记录机制

#### 5.13 ViewBridge连接问题
- 日期：2025/2/6
- 类型：系统集成问题
- 描述：ViewBridge到RemoteViewService的连接终止
- 影响：视图控制器连接和界面显示
- 解决方案：
  1. 实现视图控制器的重连机制
  2. 添加错误恢复处理
  3. 优化视图生命周期管理
  4. 实现备用显示机制
- 预防措施：
  1. 监控视图控制器状态
  2. 实现自动重连机制
  3. 添加错误日志记录
  4. 优化资源释放

#### 5.14 Metal库加载问题
- 日期：2025/2/6
- 类型：资源加载问题
- 描述：无法打开default.metallib文件
- 影响：图形渲染功能
- 解决方案：
  1. 确保Metal库文件存在于正确位置
  2. 添加资源加载错误处理
  3. 实现备用渲染方案
  4. 优化资源管理机制
- 预防措施：
  1. 在构建时验证资源完整性
  2. 实现资源自动修复机制
  3. 添加资源版本控制
  4. 优化资源打包流程

#### 5.15 聊天界面显示问题
- 日期：2025/2/6
- 类型：UI功能问题
- 描述：右侧Chat界面无法正常显示对话流
- 影响：用户交互体验
- 解决方案：
  1. 修复ChatViewModel中的消息更新机制
  2. 优化UI更新逻辑
  3. 添加消息状态管理
  4. 实现消息队列机制
- 预防措施：
  1. 实现UI状态监控
  2. 添加消息发送状态追踪
  3. 优化数据绑定机制
  4. 实现消息缓存机制

### 6. AI集成问题

## 问题记录模板

### [问题描述]
- 日期：
- 类型：
- 描述：
- 影响：
- 解决方案：
- 预防措施：

## 已解决问题列表
1. FileManager 命名冲突（2025/2/6）
2. SwiftUI API 废弃警告（2025/2/6）
3. 未使用变量警告（2025/2/6）
4. 界面布局优化（2025/2/6）
5. 类型不符合 Hashable 协议错误（2025/2/6）
6. 侧边栏宽度调整（2025/2/6）
7. 文档编辑功能增强（2025/2/6）
8. 目录选择功能问题（2025/2/6）
9. 文档切换功能问题（2025/2/6）
10. 响应式布局问题（2025/2/6）
11. 自动保存功能实现（2025/2/6）
12. 数据持久化实现（2025/2/6）
13. 目录管理优化（2025/2/6）
14. NSSecureCoding解码问题（2025/2/6）
15. ViewBridge连接问题（2025/2/6）
16. Metal库加载问题（2025/2/6）
17. 聊天界面显示问题（2025/2/6）

## 待解决问题列表

## 常见问题解答（FAQ）
1. 为什么要避免使用与系统框架相同的命名？
   - 避免命名冲突
   - 提高代码可读性
   - 减少潜在的编译错误

2. 如何处理 API 废弃警告？
   - 及时更新到新版本 API
   - 关注官方文档的更新
   - 在更新时注意兼容性问题

3. 如何保持界面设计的一致性？
   - 使用统一的常量系统
   - 遵循设计规范
   - 定期进行UI审查
